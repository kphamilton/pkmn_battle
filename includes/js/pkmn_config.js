var my_squad = {"Mr. Mime":{"name":"Mr. Mime","types":["psychic"],"attacks":{"Psychic":{"name":"Psychic","type":"psychic","power":90,"accuracy":100,"description":"A strong telekinetic attack. It may also lower the foe\u2019s SP. DEF stat.","STAB":true,"damage":0},"Safeguard":{"name":"Safeguard","type":"normal","power":0,"accuracy":100,"description":"It protects the user\u2019s party from all status problems for five turns.","STAB":false,"damage":0},"Thunderbolt":{"name":"Thunderbolt","type":"electric","power":90,"accuracy":100,"description":"A strong electrical attack that may also leave the foe paralyzed.","STAB":false,"damage":0},"Shadow Ball":{"name":"Shadow Ball","type":"ghost","power":80,"accuracy":100,"description":"A shadowy blob is hurled at the foe. May also lower the foe\u2019s SP. DEF.","STAB":false,"damage":0}},"HP":138,"Attack":55,"Defense":102,"Special Attack":127,"Special Defense":149,"Speed":166,"Number":122},"Electabuzz":{"name":"Electabuzz","types":["electric"],"attacks":{"Psychic":{"name":"Psychic","type":"psychic","power":90,"accuracy":100,"description":"A strong telekinetic attack. It may also lower the foe\u2019s SP. DEF stat.","STAB":false,"damage":0},"Thunderwave":{"name":"Thunderwave","type":"electric","power":0,"accuracy":100,"description":"A weak electric shock that is sure to cause paralysis if it hits.","STAB":true,"damage":0},"Thunderbolt":{"name":"Thunderbolt","type":"electric","power":90,"accuracy":100,"description":"A strong electrical attack that may also leave the foe paralyzed.","STAB":true,"damage":0},"Hidden Power":{"name":"Hidden Power","type":"flying","power":60,"accuracy":100,"description":"An attack that varies in type and intensity depending on the user.","STAB":false,"damage":0}},"HP":140,"Attack":115,"Defense":94,"Special Attack":158,"Special Defense":103,"Speed":135,"Number":125},"Kangaskhan":{"name":"Kangaskhan","types":["normal"],"attacks":{"Hyper Beam":{"name":"Hyper Beam","type":"normal","power":150,"accuracy":90,"description":"A severely damaging attack that makes the user rest on the next turn.","STAB":true,"damage":0},"Body Slam":{"name":"Body Slam","type":"normal","power":85,"accuracy":100,"description":"The user drops its full body on the foe. It may leave the foe paralyzed.","STAB":true,"damage":0},"Brick Break":{"name":"Brick Break","type":"fighting","power":75,"accuracy":100,"description":"An attack that also breaks any barrier like LIGHT SCREEN and REFLECT.","STAB":false,"damage":0},"Return":{"name":"Return","type":"normal","power":102,"accuracy":100,"description":"This attack move grows more powerful the more the user likes its TRAINER.","STAB":true,"damage":0}},"HP":220,"Attack":151,"Defense":99,"Special Attack":63,"Special Defense":102,"Speed":121,"Number":115},"Omastar":{"name":"Omastar","types":["water","rock"],"attacks":{"Brick Break":{"name":"Brick Break","type":"fighting","power":75,"accuracy":100,"description":"An attack that also breaks any barrier like LIGHT SCREEN and REFLECT.","STAB":true,"damage":0},"Rain Dance":{"name":"Rain Dance","type":"water","power":0,"accuracy":100,"description":"A heavy rain falls for five turns, powering up WATER- type moves.","STAB":true,"damage":0},"Toxic":{"name":"Toxic","type":"poison","power":0,"accuracy":90,"description":"A move that badly poisons the foe. Its poison damage worsens every turn.","STAB":false,"damage":0},"Ice Beam":{"name":"Ice Beam","type":"ice","power":90,"accuracy":100,"description":"The foe is struck with an icy beam. It may freeze the foe solid.","STAB":false,"damage":0}},"HP":154,"Attack":74,"Defense":170,"Special Attack":178,"Special Defense":73,"Speed":106,"Number":139},"Nidoking":{"name":"Nidoking","types":["poison","ground"],"attacks":{"Surf":{"name":"Surf","type":"water","power":95,"accuracy":100,"description":"A big wave crashes down on the foe. Can also be used for crossing water.","STAB":false,"damage":0},"Sludge Bomb":{"name":"Sludge Bomb","type":"poison","power":90,"accuracy":100,"description":"Filthy sludge is hurled at the foe. It may poison the target.","STAB":true,"damage":0},"Megahorn":{"name":"Megahorn","type":"bug","power":120,"accuracy":85,"description":"A brutal ramming attack delivered with a tough and impressive horn.","STAB":false,"damage":0},"Earthquake":{"name":"Earthquake","type":"ground","power":100,"accuracy":100,"description":"An earthquake that strikes all POK\u00e9MON in battle excluding the user.","STAB":true,"damage":0}},"HP":158,"Attack":147,"Defense":99,"Special Attack":101,"Special Defense":103,"Speed":129,"Number":34},"Hitmonlee":{"name":"Hitmonlee","types":["fighting"],"attacks":{"Surf":{"name":"Surf","type":"water","power":95,"accuracy":100,"description":"A big wave crashes down on the foe. Can also be used for crossing water.","STAB":true,"damage":0},"Hidden Power":{"name":"Hidden Power","type":"ice","power":70,"accuracy":100,"description":"An attack that varies in type and intensity depending on the user.","STAB":false,"damage":0},"Focus Punch":{"name":"Focus Punch","type":"fighting","power":150,"accuracy":100,"description":"An attack that is executed last. The user flinches if hit beforehand.","STAB":true,"damage":0},"Substitute":{"name":"Substitute","type":"normal","power":0,"accuracy":100,"description":"The user creates a decoy using one- quarter of its full HP.","STAB":false,"damage":0}},"HP":137,"Attack":188,"Defense":75,"Special Attack":51,"Special Defense":136,"Speed":151,"Number":106}};
var all_pokes = {"Arbok":{"name":"Arbok","types":["poison"],"attacks":[],"HP":60,"Attack":85,"Defense":69,"Special Attack":65,"Special Defense":79,"Speed":80,"Number":24},"Blastoise":{"name":"Blastoise","types":["water"],"attacks":[],"HP":79,"Attack":83,"Defense":100,"Special Attack":85,"Special Defense":105,"Speed":78,"Number":9},"Clefable":{"name":"Clefable","types":["normal"],"attacks":[],"HP":95,"Attack":70,"Defense":73,"Special Attack":85,"Special Defense":90,"Speed":60,"Number":36},"Electabuzz":{"name":"Electabuzz","types":["electric"],"attacks":[],"HP":65,"Attack":83,"Defense":57,"Special Attack":95,"Special Defense":85,"Speed":105,"Number":125},"Electrode":{"name":"Electrode","types":["electric"],"attacks":[],"HP":60,"Attack":50,"Defense":70,"Special Attack":80,"Special Defense":80,"Speed":140,"Number":101},"Fearow":{"name":"Fearow","types":["normal","flying"],"attacks":[],"HP":65,"Attack":90,"Defense":65,"Special Attack":61,"Special Defense":61,"Speed":100,"Number":22},"Flareon":{"name":"Flareon","types":["fire"],"attacks":[],"HP":65,"Attack":130,"Defense":60,"Special Attack":95,"Special Defense":110,"Speed":65,"Number":136},"Golduck":{"name":"Golduck","types":["water"],"attacks":[],"HP":80,"Attack":82,"Defense":78,"Special Attack":95,"Special Defense":80,"Speed":85,"Number":55},"Golem":{"name":"Golem","types":["rock","ground"],"attacks":[],"HP":80,"Attack":110,"Defense":130,"Special Attack":55,"Special Defense":65,"Speed":45,"Number":76},"Hitmonchan":{"name":"Hitmonchan","types":["fighting"],"attacks":[],"HP":50,"Attack":105,"Defense":79,"Special Attack":35,"Special Defense":110,"Speed":76,"Number":107},"Hitmonlee":{"name":"Hitmonlee","types":["fighting"],"attacks":[],"HP":50,"Attack":120,"Defense":53,"Special Attack":35,"Special Defense":110,"Speed":87,"Number":106},"Hypno":{"name":"Hypno","types":["psychic"],"attacks":[],"HP":85,"Attack":73,"Defense":70,"Special Attack":73,"Special Defense":115,"Speed":67,"Number":97},"Kabutops":{"name":"Kabutops","types":["rock","water"],"attacks":[],"HP":60,"Attack":115,"Defense":105,"Special Attack":65,"Special Defense":70,"Speed":80,"Number":141},"Kangaskhan":{"name":"Kangaskhan","types":["normal"],"attacks":[],"HP":105,"Attack":95,"Defense":80,"Special Attack":40,"Special Defense":80,"Speed":90,"Number":115},"Kingler":{"name":"Kingler","types":["water"],"attacks":[],"HP":55,"Attack":130,"Defense":115,"Special Attack":50,"Special Defense":50,"Speed":75,"Number":99},"Magmar":{"name":"Magmar","types":["fire"],"attacks":[],"HP":65,"Attack":95,"Defense":57,"Special Attack":100,"Special Defense":85,"Speed":93,"Number":126},"Mr. Mime":{"name":"Mr. Mime","types":["psychic"],"attacks":[],"HP":40,"Attack":45,"Defense":65,"Special Attack":100,"Special Defense":120,"Speed":90,"Number":122},"Muk":{"name":"Muk","types":["poison"],"attacks":[],"HP":105,"Attack":105,"Defense":75,"Special Attack":65,"Special Defense":100,"Speed":50,"Number":89},"Nidoking":{"name":"Nidoking","types":["poison","ground"],"attacks":[],"HP":81,"Attack":92,"Defense":77,"Special Attack":85,"Special Defense":75,"Speed":85,"Number":34},"Nidoqueen":{"name":"Nidoqueen","types":["poison","ground"],"attacks":[],"HP":90,"Attack":82,"Defense":87,"Special Attack":75,"Special Defense":85,"Speed":76,"Number":31},"Ninetales":{"name":"Ninetales","types":["fire"],"attacks":[],"HP":73,"Attack":76,"Defense":75,"Special Attack":81,"Special Defense":100,"Speed":100,"Number":38},"Omastar":{"name":"Omastar","types":["rock","water"],"attacks":[],"HP":70,"Attack":60,"Defense":125,"Special Attack":115,"Special Defense":70,"Speed":55,"Number":139},"Persian":{"name":"Persian","types":["normal"],"attacks":[],"HP":65,"Attack":70,"Defense":60,"Special Attack":65,"Special Defense":65,"Speed":115,"Number":53},"Pinsir":{"name":"Pinsir","types":["bug"],"attacks":[],"HP":65,"Attack":125,"Defense":100,"Special Attack":55,"Special Defense":70,"Speed":85,"Number":127},"Poliwrath":{"name":"Poliwrath","types":["water","fighting"],"attacks":[],"HP":90,"Attack":85,"Defense":95,"Special Attack":70,"Special Defense":90,"Speed":70,"Number":62},"Primeape":{"name":"Primeape","types":["fighting"],"attacks":[],"HP":65,"Attack":105,"Defense":60,"Special Attack":60,"Special Defense":70,"Speed":95,"Number":57},"Raichu":{"name":"Raichu","types":["electric"],"attacks":[],"HP":60,"Attack":90,"Defense":55,"Special Attack":90,"Special Defense":80,"Speed":100,"Number":26},"Rapidash":{"name":"Rapidash","types":["fire"],"attacks":[],"HP":65,"Attack":100,"Defense":70,"Special Attack":80,"Special Defense":80,"Speed":105,"Number":78},"Sandslash":{"name":"Sandslash","types":["ground"],"attacks":[],"HP":75,"Attack":100,"Defense":110,"Special Attack":45,"Special Defense":55,"Speed":65,"Number":28},"Scyther":{"name":"Scyther","types":["bug","flying"],"attacks":[],"HP":70,"Attack":110,"Defense":80,"Special Attack":55,"Special Defense":80,"Speed":105,"Number":123},"Tangela":{"name":"Tangela","types":["grass"],"attacks":[],"HP":65,"Attack":55,"Defense":115,"Special Attack":100,"Special Defense":40,"Speed":60,"Number":114},"Tentacruel":{"name":"Tentacruel","types":["water","poison"],"attacks":[],"HP":80,"Attack":70,"Defense":65,"Special Attack":80,"Special Defense":120,"Speed":100,"Number":73},"Victreebel":{"name":"Victreebel","types":["grass","poison"],"attacks":[],"HP":80,"Attack":105,"Defense":65,"Special Attack":100,"Special Defense":60,"Speed":70,"Number":71},"Vileplume":{"name":"Vileplume","types":["grass","poison"],"attacks":[],"HP":75,"Attack":80,"Defense":85,"Special Attack":100,"Special Defense":90,"Speed":50,"Number":45}};
var type_chart = {"normal":{"rock":0.5,"ghost":0,"steel":0.5},"fire":{"fire":0.5,"water":0.5,"grass":2,"ice":2,"bug":2,"rock":0.5,"dragon":0.5,"steel":2},"water":{"fire":2,"water":0.5,"grass":0.5,"ground":2,"rock":2,"dragon":0.5},"electric":{"water":2,"electric":0.5,"grass":0.5,"ground":0,"flying":2,"dragon":0.5},"grass":{"fire":0.5,"water":2,"grass":0.5,"poison":0.5,"ground":2,"flying":0.5,"bug":0.5,"rock":2,"dragon":0.5,"steel":0.5},"ice":{"fire":0.5,"water":0.5,"grass":2,"ice":0.5,"ground":2,"flying":2,"dragon":2,"steel":0.5},"fighting":{"normal":2,"ice":2,"poison":0.5,"flying":0.5,"psychic":0.5,"bug":0.5,"rock":2,"ghost":0,"dark":2,"steel":2,"fai":0.5},"poison":{"grass":2,"poison":0.5,"ground":0.5,"rock":0.5,"ghost":0.5,"steel":0,"fai":2},"ground":{"fire":2,"electric":2,"grass":0.5,"poison":2,"flying":0,"bug":0.5,"rock":2,"steel":2},"flying":{"electric":0.5,"grass":2,"fighting":2,"bug":2,"rock":0.5,"steel":0.5},"psychic":{"fighting":2,"poison":2,"psychic":0.5,"dark":0,"steel":0.5},"bug":{"fire":0.5,"grass":2,"fighting":0.5,"poison":0.5,"flying":0.5,"psychic":2,"ghost":0.5,"dark":2,"steel":0.5,"fai":0.5},"rock":{"fire":2,"ice":2,"fighting":0.5,"ground":0.5,"flying":2,"bug":2,"steel":0.5},"ghost":{"normal":0,"psychic":2,"ghost":2,"dark":0.5},"dragon":{"dragon":2,"steel":0.5,"fai":0},"dark":{"fighting":0.5,"psychic":2,"ghost":2,"dark":0.5,"fai":0.5},"steel":{"fire":0.5,"water":0.5,"electric":0.5,"ice":2,"rock":2,"steel":0.5,"fai":2}};
var attack_lookup = {"normal":"Attack","fighting":"Attack","poison":"Attack","ground":"Attack","flying":"Attack","bug":"Attack","rock":"Attack","ghost":"Attack","steel":"Attack","fire":"Special Attack","water":"Special Attack","electric":"Special Attack","grass":"Special Attack","ice":"Special Attack","psychic":"Special Attack","dragon":"Special Attack","dark":"Special Attack"};
var level = 55;
var html = "";
for (var poke in all_pokes) {

    var number = all_pokes[poke]['Number'];
    number = pad(number, 3);

    html += '<div class="col-md-2 well" style="margin: 0px;"><a data-target="#'+all_pokes[poke]['Number']+'modal" onclick="trigger_comparison(\''+all_pokes[poke]['name']+'\')">';
    html += '<img src="files/img/'+number+'.png"/><br/>';
    html += all_pokes[poke]['name'];
    html += '</a></div>';
}

$("#pokemon_list").html(html);

function pad (str, max) {
    str = str.toString();
    return str.length < max ? pad("0" + str, max) : str;
}

function damage_calculation(my_poke, opp_poke, attack_name) {
    var power = my_poke['attacks'][attack_name]['power'];
    var attack_stat = my_poke[attack_lookup[my_poke['attacks'][attack_name]['type']]];
    var defense_stat = "";
    if(attack_lookup[my_poke['attacks'][attack_name]['type']] == "Attack")
        defense_stat = "Defense";
    else if(attack_lookup[my_poke['attacks'][attack_name]['type']] == "Special Attack")
        defense_stat = "Special Defense";
    defense_stat = opp_poke[defense_stat];
    var stab = 1;
    if(my_poke['attacks'][attack_name]['STAB'] == true)
        stab = 1.5;

    var weakness_resistance = get_weakness_resistance(my_poke['attacks'][attack_name]['type'], opp_poke['types']);
    var high_damage_formula =  ((((2 * level / 5 + 2) * attack_stat * power / defense_stat) / 50) + 2) * stab * weakness_resistance * 100 / 100;
    var low =  ((((2 * level / 5 + 2) * attack_stat * power / defense_stat) / 50) + 2) * stab * weakness_resistance * 85 / 100;

    var new_high = ((((((((2*level/5+2)*attack_stat*power)/defense_stat)/50)+2)*stab)*weakness_resistance)*255)/255;
    var new_low = ((((((((2*level/5+2)*attack_stat*power)/defense_stat)/50)+2)*stab)*weakness_resistance)*217)/255;

    return high_damage_formula
}

function get_weakness_resistance(attack_type, opp_types) {
    var multiplier = 1;
    opp_types.forEach(function(type) {
        if(type_chart[attack_type][type])
            multiplier = multiplier * type_chart[attack_type][type]
    });
    return multiplier;
}

function trigger_comparison(pokemon_name) {
    var ranking = new Array();

    for (var poke in my_squad) {
        max_attack = 0;
        max_attack_name = "";

        for (var attack_name in my_squad[poke]['attacks']) {
            var damage = damage_calculation(my_squad[poke], all_pokes[pokemon_name], attack_name);
            if(damage > max_attack) {
                max_attack = damage;
                max_attack_name = attack_name;
            }
            my_squad[poke]['attacks'][attack_name]['damage'] = damage;
        }
        ranking.push({name: my_squad[poke]['name']+"_"+max_attack_name, val: max_attack});


    }
    ranking.sort(function(a,b) {
        return b.val - a.val;
    });

var modal_html = "<div class='modal fade' id='"+all_pokes[pokemon_name]["Number"]+"modal' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'> \
    <div class='modal-dialog'> \
        <div class='modal-content'> \
            <div class='modal-header'> \
                <button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button> \
                <h4 class='modal-title' id='myModalLabel'>Versus "+pokemon_name+"</h4> \
            </div> \
            <div class='modal-body'>";

    for (obj in ranking) {
        //modal_html += ranking[obj]['name']+ranking[obj]['val']+"<br/>";
        var poke_split = ranking[obj]['name'].split("_");
        var name = poke_split[0];
        var attack = poke_split[1];
        modal_html += '<div class="col-md-4 well" style="margin: 0px;">';

        modal_html += '<div style="float:right">';
        for (var attack_name in my_squad[name]['attacks']) {
            if(attack_name == attack) {
                modal_html += "<span class='label label-success' style='line-height:2;'>"+attack_name+ " - "+Math.round(my_squad[name]['attacks'][attack_name]['damage'])+"</span><br/>";
            }
            else {
                modal_html += "<span class='label label-default' style='line-height:2;'>"+attack_name+ " - "+Math.round(my_squad[name]['attacks'][attack_name]['damage'])+"</span><br/>";
            }
        }
        modal_html += '</div>';





        modal_html += '<img src="files/img/'+pad(my_squad[name]['Number'], 3)+'.png"/><br/>';
        modal_html += my_squad[name]['name'];


        modal_html += '</div>';
    }

    modal_html +="</div> \
            <div class='modal-footer'> \
                <button type='button' class='btn btn-default' data-dismiss='modal'>Close</button> \
            </div> \
        </div> \
    </div> \
</div>";
$("#container").append(modal_html);
    $('#'+all_pokes[pokemon_name]["Number"]+'modal').modal('show',{
        backdrop: true,
        keyboard: false
    });
}
